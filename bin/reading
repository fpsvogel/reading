#!/usr/bin/env ruby

# Starts the reading statistics interactive CLI.
#
# Usage:
# Run on the command line:
#   reading "<CSV file path>"
#
# Example:
#   reading /home/felipe/reading.csv

require_relative "../lib/reading"
require "readline"
require "pastel"
require "debug"

EXIT_COMMANDS = %w[exit e quit q]
pastel = Pastel.new

path = ARGV[0]
unless path
  raise ArgumentError,
    "CSV file path argument required. Example: reading /home/felipe/reading.csv"
end

config = {}
if ARGV[1]
  # TODO: optional arg for path to custom config
end

items = Reading.parse(path:, config:)

loop do
  raw_input = Readline.readline(pastel.bright_cyan("> "), true)

  exit if EXIT_COMMANDS.include?(raw_input)

  input = raw_input.presence
  next if raw_input.blank?

  puts Reading.stats(input:, items:, config:)
end
